language: python

python:
  - 3.6

sudo: true

services:
  - docker

before_install:
  - docker run --name knit_test -d -v $PWD:/knit mdurant/hadoop
  - export CONTAINER_ID=`docker ps | grep knit_test | awk '{print $1}'`
  - sleep 20

install:
  - docker exec -it $CONTAINER_ID conda create -y -n test python=$TRAVIS_PYTHON_VERSION pytest dask distributed

script:
  - docker exec -it $CONTAINER_ID bash /knit/continuous_integration/coverage_test.sh

after_success:
  - docker exec -it $CONTAINER_ID bash -c "export TRAVIS=$TRAVIS && export TRAVIS_JOB_ID=$TRAVIS_JOB_ID && TRAVIS_BRANCH=$TRAVIS_BRANCH && /knit/continuous_integration/coverage_upload.sh"
  - docker exec -it $CONTAINER_ID kill 1

